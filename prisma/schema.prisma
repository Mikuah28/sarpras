generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

enum Role {
  admin
  user
}

model User {
  id       Int     @id @default(autoincrement())
  email    String  @db.VarChar(60)
  username String? @db.VarChar(60)
  password String  @db.VarChar(120)
  role     Role    @default(user)

  borrowingsBorrower Borrowing[] @relation("Borrower")
  borrowingsApprover Borrowing[] @relation("Approver")
  returnsApprover    Returning[] @relation("ReturnApprover")

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Kategori {
  id   Int    @id @default(autoincrement())
  name String @db.VarChar(80)

  items Item[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Item {
  id          Int     @id @default(autoincrement())
  name        String  @db.VarChar(80)
  description String?
  stock       Int
  image_url   String?

  categoryId Int
  category   Kategori @relation(fields: [categoryId], references: [id])

  borrowings Borrowing[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

enum BorrowStatus {
  pending
  approved
  rejected
  returned
}

model Borrowing {
  id              Int          @id @default(autoincrement())
  qty             Int
  status          BorrowStatus @default(pending)
  itemId          Int
  item            Item         @relation(fields: [itemId], references: [id])
  borrowingUserId Int
  borrower        User         @relation("Borrower", fields: [borrowingUserId], references: [id])
  approvedBy      Int?
  approver        User?        @relation("Approver", fields: [approvedBy], references: [id])

  createdAt DateTime    @default(now())
  updatedAt DateTime    @updatedAt
  Returning Returning[]
}

enum ReturnStatus {
  pending
  approved
  rejected
}

model Returning {
  id          Int          @id @default(autoincrement())
  qty         Int
  status      ReturnStatus @default(pending)
  borrowingId Int
  borrowing   Borrowing    @relation(fields: [borrowingId], references: [id])
  approvedBy  Int?
  approver    User?        @relation("ReturnApprover", fields: [approvedBy], references: [id])

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}
